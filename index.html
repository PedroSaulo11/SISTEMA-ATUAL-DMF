<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>DMF Enterprise - Fluxo Financeiro v2.0</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="icon" type="image/png" href="/assets/logo-dmf.png">
    <link rel="apple-touch-icon" href="/assets/logo-dmf.png">
    <link rel="manifest" href="/manifest.webmanifest?v=20260215-f6">
    <meta name="theme-color" content="#0052cc">
    <link rel="stylesheet" href="style.css?v=20260215-f6">
    <link rel="stylesheet" href="assistant.css?v=20260215-f1">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>

<header id="mobileTopbar" class="mobile-topbar">
    <button id="btnMobileMenu" class="icon-btn" type="button" aria-label="Abrir menu" aria-controls="sidebar" aria-expanded="false">
        <span class="hamburger" aria-hidden="true"></span>
    </button>
    <div class="mobile-brand" aria-label="DMF Fluxo">
        <img class="mobile-logo" src="/assets/logo-dmf.png" alt="DMF">
        <span class="mobile-title">DMF FLUXO</span>
    </div>
    <div class="mobile-view">
        <span id="mobileViewTitle" class="mobile-view-title">Dashboard</span>
        <span id="mobileNetBadge" class="mobile-net-badge hidden" aria-live="polite">Offline</span>
    </div>
</header>
<div id="sidebarOverlay" class="sidebar-overlay hidden" aria-hidden="true"></div>

<div id="loginSection" class="login-screen">
    <div class="login-box">
        <h2 class="login-title">DMF Empreendimentos</h2>
        <div class="form-group">
            <input type="text" id="loginInput" placeholder="Usuário ou Email" class="styled-input">
            <input type="password" id="loginPass" placeholder="Senha" class="styled-input">
        </div>
        <button id="btnLogin" class="btn btn-primary btn-full">Acessar Sistema</button>
        <p class="login-subtitle">Acesso restrito a colaboradores autorizados.</p>
    </div>
</div>

<div id="appSection" class="app-wrapper hidden">
    <aside id="sidebar" class="sidebar" aria-label="Menu lateral">
        <div class="sidebar-header">
            <h3>DMF FLUXO</h3>
            <p id="userRoleBadge" class="user-role-badge"></p>
            <div id="backendStatus" class="backend-status">Servidor: verificando...</div>
            <div id="sessionStatus" class="backend-status">Sessão: verificando...</div>
            <div id="syncCountdown" class="backend-status">Sincronizando novamente em: --:--</div>
        </div>
        <nav class="sidebar-nav">
            <button class="btn-side active" data-nav="dashboard">Dashboard</button>
            <button id="btnPaymentsToggle" class="btn-side btn-side-toggle" type="button" aria-expanded="false">
                <span>Fluxo de Pagamentos</span>
                <span id="paymentsToggleIcon" class="toggle-icon" aria-hidden="true"></span>
            </button>
            <div id="paymentsSubmenu" class="sidebar-submenu hidden">
                <button class="btn-side btn-sub" data-nav="payments" data-company="Real Energy">Fluxo de Pagamentos Real Energy</button>
                <button class="btn-side btn-sub" data-nav="payments" data-company="DMF">Fluxo de Pagamentos DMF</button>
                <button class="btn-side btn-sub" data-nav="payments" data-company="JFX">Fluxo de Pagamentos JFX</button>
            </div>
            <button class="btn-side" data-nav="audit">Logs de Auditoria</button>
            <button id="adminMenu" class="btn-side hidden" data-nav="admin">Administração</button>
            <button class="btn-side" data-nav="assistente">Assistente</button>
            <button class="btn-side" data-nav="cobli">Cobli</button>
        </nav>
        <button id="btnLogout" class="btn btn-logout">Sair</button>
        <button id="btnRevokeSelf" class="btn btn-ghost hidden">Revogar Sessões</button>
    </aside>

    <main class="main-content">
        <section id="accessDenied" class="view hidden"></section>
        <section id="dashboard" class="view" data-fragment="dashboard.fragment.html"></section>

        <section id="payments" class="view hidden" data-fragment="payments.fragment.html"></section>

        <section id="audit" class="view hidden" data-fragment="audit.fragment.html"></section>

        <section id="admin" class="view hidden" data-fragment="admin.fragment.html"></section>

        <section id="assistente" class="view hidden" data-fragment="assistente.fragment.html"></section>

        <section id="cobli" class="view hidden" data-fragment="cobli.fragment.html"></section>
    </main>
</div>

<div id="toastContainer" class="toast-container"></div>

<!-- Reauth modal for sensitive admin actions -->
<div id="reauthModal" class="modal" aria-hidden="true">
    <div class="modal-content reauth-modal-content" role="dialog" aria-modal="true" aria-labelledby="reauthTitle">
        <h3 id="reauthTitle" class="reauth-title">Confirmar Ação</h3>
        <p id="reauthDescription" class="reauth-desc">Digite a senha do admin para continuar.</p>

        <div id="reauthStepPassword" class="reauth-step">
            <input type="password" id="reauthPassword" class="styled-input" placeholder="Senha do admin" autocomplete="current-password">
            <div id="reauthError" class="reauth-error hidden"></div>
        </div>

        <div id="reauthStepConfirm" class="reauth-step hidden">
            <div class="reauth-confirm-note">Senha confirmada. Deseja realmente executar esta ação?</div>
        </div>

        <div class="modal-actions">
            <button type="button" id="btnReauthConfirm" class="btn btn-success">Confirmar</button>
            <button type="button" id="btnReauthCancel" class="btn btn-danger">Cancelar</button>
        </div>
    </div>
</div>

<!-- Modal for Creating User -->
<div id="createUserModal" class="modal">
    <div class="modal-content">
        <span class="close" data-close-modal="createUserModal">&times;</span>
        <h3>Criar Novo Usuário</h3>
        <form id="createUserForm">
            <div class="form-group">
                <label for="userName">Nome:</label>
                <input type="text" id="userName" name="userName" required>
            </div>
            <div class="form-group">
                <label for="userUsername">Usuário:</label>
                <input type="text" id="userUsername" name="userUsername" required>
            </div>
            <div class="form-group">
                <label for="userEmail">Email:</label>
                <input type="email" id="userEmail" name="userEmail" required>
            </div>
            <div class="form-group">
                <label for="userPassword">Senha:</label>
                <input type="password" id="userPassword" name="userPassword" required>
            </div>
            <div class="form-group">
                <label for="userRole">Cargo:</label>
                <select id="userRole" name="userRole" required>
                    <option value="">Selecione um cargo</option>
                    <option value="admin">Admin</option>
                    <option value="gestor">Gestor</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Criar Usuário</button>
        </form>
    </div>
</div>

<!-- Modal for Creating Role -->
<div id="createRoleModal" class="modal">
    <div class="modal-content">
        <span class="close" data-close-modal="createRoleModal">&times;</span>
        <h3>Criar Novo Cargo</h3>
        <form id="createRoleForm">
            <div class="form-group">
                <label for="roleName">Nome do Cargo:</label>
                <input type="text" id="roleName" name="roleName" required>
            </div>
            <div class="form-group">
                <label>Permissões:</label>
                <div class="permissions">
                    <label>
                        Usuário pode adicionar novos Pagamentos?
                        <select id="rolePermAddPayments">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário pode assinar Fluxo de Pagamentos?
                        <select id="rolePermSignPayments">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário Pode Ver a aba Administração?
                        <select id="rolePermViewAdmin">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário pode Acessar a Aba Logs de Auditoria?
                        <select id="rolePermAccessAudit">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário Pode Importar Fluxo de Pagamentos?
                        <select id="rolePermImportPayments">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário Pode Exportar Fluxo de Pagamentos?
                        <select id="rolePermExportPayments">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário pode Ver Fluxos Anteriores?
                        <select id="rolePermViewArchives">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário pode Enviar para Fluxos Anteriores?
                        <select id="rolePermArchiveFlow">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário pode Excluir Fluxos Anteriores?
                        <select id="rolePermDeleteArchive">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário pode Exportar Fluxos Anteriores?
                        <select id="rolePermExportArchive">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário pode Comparar Fluxos Anteriores?
                        <select id="rolePermCompareArchives">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                    <label>
                        Usuário pode Ver Logs de Acesso?
                        <select id="rolePermAuditLogin">
                            <option value="no">Não</option>
                            <option value="yes">Sim</option>
                        </select>
                    </label>
                </div>
            </div>
            <button type="submit" class="btn btn-primary">Criar Cargo</button>
        </form>
    </div>
</div>

<!-- Modal for Editing User -->
<div id="editUserModal" class="modal">
    <div class="modal-content">
        <span class="close" data-close-modal="editUserModal">&times;</span>
        <h3>Editar Usuário</h3>
        <form id="editUserForm">
            <input type="hidden" id="editUserId" name="editUserId">
            <div class="form-group">
                <label for="editUserName">Nome:</label>
                <input type="text" id="editUserName" name="editUserName" required>
            </div>
            <div class="form-group">
                <label for="editUserUsername">Usuário:</label>
                <input type="text" id="editUserUsername" name="editUserUsername" required>
            </div>
            <div class="form-group">
                <label for="editUserEmail">Email:</label>
                <input type="email" id="editUserEmail" name="editUserEmail" required>
            </div>
            <div class="form-group">
                <label for="editUserRole">Cargo:</label>
                <select id="editUserRole" name="editUserRole" required>
                    <option value="admin">Admin</option>
                    <option value="gestor">Gestor</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Atualizar Usuário</button>
        </form>
    </div>
</div>

<!-- Modal for Changing Password -->
<div id="changePasswordModal" class="modal">
    <div class="modal-content">
        <span class="close" data-close-modal="changePasswordModal">&times;</span>
        <h3>Trocar Senha</h3>
        <p>Alterando senha para: <strong id="changePasswordUserName"></strong></p>
        <form id="changePasswordForm">
            <input type="hidden" id="changePasswordUserId" name="changePasswordUserId">
            <div class="form-group">
                <label for="newPassword">Nova Senha:</label>
                <input type="password" id="newPassword" name="newPassword" required>
            </div>
            <div class="form-group">
                <label for="confirmPassword">Confirmar Senha:</label>
                <input type="password" id="confirmPassword" name="confirmPassword" required>
            </div>
            <button type="submit" class="btn btn-primary">Alterar Senha</button>
        </form>
    </div>
</div>

<!-- Modal: Adicionar Pagamento --> <!-- ALTERADO -->
<div id="addPaymentModal" class="modal"> <!-- ALTERADO -->
  <div class="modal-content add-payment-card">
    <span class="close" data-close-modal="addPaymentModal">&times;</span>
    <h3>Adicionar Pagamento</h3>
    <form id="addPaymentForm"> <!-- ALTERADO -->
      <div class="form-group">
        <label for="addFornecedor">Fornecedor:</label>
        <input type="text" id="addFornecedor" name="fornecedor" required> <!-- ALTERADO -->
      </div>
      <div class="form-group">
        <label for="addData">Data:</label>
        <input type="date" id="addData" name="data" required> <!-- ALTERADO -->
      </div>
      <div class="form-group">
        <label for="addDescricao">Descrição:</label>
        <input type="text" id="addDescricao" name="descricao"> <!-- ALTERADO -->
      </div>
      <div class="form-group">
        <label for="addValor">Valor:</label>
        <input type="text" id="addValor" name="valor" placeholder="Ex.: 1.234,56" required> <!-- ALTERADO -->
      </div>
      <div class="form-group">
        <label for="addCentro">Centro de Custo:</label>
        <input type="text" id="addCentro" name="centro" placeholder="Informe o centro de custo" required list="centrosDataList"> <!-- ALTERADO -->
        <datalist id="centrosDataList"></datalist> <!-- ALTERADO -->
      </div>
      <div class="form-group">
        <label for="addCategoria">Categoria:</label>
        <input type="text" id="addCategoria" name="categoria" placeholder="Categoria"> <!-- ALTERADO -->
      </div>
      <div class="modal-actions">
        <button type="button" class="btn btn-danger" data-close-modal="addPaymentModal">Cancelar</button> <!-- ALTERADO -->
        <button type="submit" class="btn btn-primary">Adicionar</button> <!-- ALTERADO -->
      </div>
    </form>
  </div>
</div>

<!-- Modal: Novo Centro de Custo -->
<div id="centerAssignModal" class="modal">
  <div class="modal-content center-assign-card">
    <span class="close" data-close-modal="centerAssignModal">&times;</span>
    <h3>Novo Centro de Custo Identificado</h3>
    <p>Encontramos um novo Centro de Custo:</p>
    <div class="center-assign-highlight" id="centerAssignName">—</div>
    <p>Selecione em qual empresa este centro deve ser encaixado e salve abaixo:</p>
    <div class="center-assign-actions">
      <select id="centerAssignCompany" class="styled-input">
        <option value="DMF">DMF</option>
        <option value="JFX">JFX</option>
        <option value="Real Energy">Real Energy</option>
        <option value="Outros">Outros</option>
      </select>
    </div>
    <div class="modal-actions">
      <button type="button" id="btnSaveCenterAssignment" class="btn btn-success">Salvar Centro</button>
      <button type="button" class="btn btn-danger" data-close-modal="centerAssignModal">Fechar</button>
    </div>
  </div>
</div>

<script src="bootstrap.js?v=20260215-f6"></script>
</body>
</html>
